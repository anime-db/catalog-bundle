services:
    # Plugins chain
    anime_db.plugin.filler:
        class: AnimeDb\Bundle\CatalogBundle\Plugin\Fill\Filler\Chain
    anime_db.plugin.search_fill:
        class: AnimeDb\Bundle\CatalogBundle\Plugin\Fill\Search\Chain
        arguments: [ %default_search% ]
    anime_db.plugin.refiller:
        class: AnimeDb\Bundle\CatalogBundle\Plugin\Fill\Refiller\Chain
    anime_db.plugin.import:
        class: AnimeDb\Bundle\CatalogBundle\Plugin\Import\Chain
    anime_db.plugin.item:
        class: AnimeDb\Bundle\CatalogBundle\Plugin\Item\Chain
    anime_db.plugin.setting:
        class: AnimeDb\Bundle\CatalogBundle\Plugin\Setting\Chain

    # Twig extension
    anime_db.catalog_twig_extension:
        class: AnimeDb\Bundle\CatalogBundle\Service\TwigExtension
        tags:
            - { name: twig.extension }

    # Form
    anime_db.form.type.item:
        class: AnimeDb\Bundle\CatalogBundle\Form\Entity\Item
        tags:
            - { name: form.type, alias: anime_db_catalog_entity_item }
        calls:
            - [ setRefillerChain, [ @anime_db.plugin.refiller ] ]
            - [ setTemplating, [ @templating ] ]

    anime_db.subscriber.scan_storage:
        class: AnimeDb\Bundle\CatalogBundle\Event\Subscriber\ScanStorage
        arguments: [ @doctrine.orm.entity_manager, @templating, @anime_db.plugin.search_fill, @router ]
        tags: [{ name:kernel.event_subscriber }]

    anime_db.search.driver.sql_like:
        class: AnimeDb\Bundle\CatalogBundle\Service\Search\Driver\SqlLike
        arguments: [ @doctrine ]
        public: false

    anime_db.search:
        class: AnimeDb\Bundle\CatalogBundle\Service\Search\Manager
        arguments: [ @anime_db.search.driver ]
